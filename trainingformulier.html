<html>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

<head>
    <style>
        .btn-primary {
            background-color: darkcyan;
        }

        .btn-primary:hover {
            box-shadow: 0 12px 16px 0 rgba(0, 0, 0, 0.24), 0 17px 50px 0 rgba(0, 0, 0, 0.19);
        }
    </style>

    <script>

        var basisUrl = "http://173.212.208.199:8083/";

        function verwijsPagina(url) {
            window.location.href = url;
        }

        $(window).on('load', function(){
            getTeams();
        })

        function getTeams() {
            teams = {}
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (this.readyState == 4) {
                    var teams = JSON.parse(this.responseText);
                    console.log(teams);
                    createButton(teams)
                    console.log(teams.teamnaam);
                }
            }
            xhr.open("GET", basisUrl + "/teamlijst", true)
            xhr.send();
        }

        function createButton(teamlijst){
            document.getElementById("team").value = teamlijst.teamnaam;


            var col = [];
            var table = document.createElement("table");
            table.className = "table table-bordered table-sm table-hover ";
            var tr = table.insertRow(-1);

            for (var i = 0; i < teamlijst.length; i++) {
                for (var key in teamlijst[i]) {
                    if (col.indexOf(key) === -1) {
                        col.push(key);
                    }
                }
            }

            for (var i = 0; i < col.length; i++) {
                var th = document.createElement("th");
                th.style = "background-color: darkcyan";
                th.innerHTML = col[i];
                tr.appendChild(th);
            }

            for (var i = 0; i < teamlijst.length; i++) {
                tr = table.insertRow(-1);
                for (var j = 0; j < col.length; j++) {
                    var tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = teamlijst[i][col[j]];
                }
                tr.onclick = function () {
                    if (typeof index !== "undefined") {
                        table.rows[index].classList.toggle("selected");
                    }
                    index = this.rowIndex
                    this.classList.toggle("selected");
                    lid = this.cells[0].innerHTML;
                }
            }
            var divContainer = document.getElementById("showData");
            divContainer.innerHTML = "";
            divContainer.appendChild(table);
            
        }
        

        function aanmaakTraining() {
            var trainObject = {};
            trainObject.dag = document.getElementById('dag').value;
            trainObject.tijd = document.getElementById('tijdstip').value;
            trainObject.locatie = document.getElementById('locatie').value;
            
            aantalTrainingen = document.getElementById('aantalTrainingen').value;
            trainObject.team = document.getElementById('team').value;
        

        var trainingJSON = JSON.stringify(trainObject);

        if (trainObject.dag != null &
            trainObject.tijd != null &
            trainObject.locatie != null &
            trainObject.aantalTrainingen != null &
            trainObject.team != null) {
            trainVersturen(trainingJSON);
        } else {
            alert("Niet alle velden zijn ingevuld")
        
        }

        function trainVersturen (aantalTrainingen, teamId){
            var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        console.log("Training is aangemaakt")
                        verwijspagina('bedanktTraining.html');
                    }
                }
                xhr.open("POST", basisUrl + "/trainingen/maaktraining/" + aantalTrainingen + "/" + teamId , true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.send(data);
            }
        
        }

        

    </script>

</head>

<body>
    <h2 class="text-center">Maak training aan</h2>

    <form class="form-horizontal" class="was-validated">
        <div class="form-group">
            <label class="control-label col-sm-2" for="dag">Dag:</label>
            <div class="col-sm-10">
                <input type="date" class="form-control" id="dag" required>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-2" for="tijdstip">Tijdstip:</label>
            <div class="col-sm-10">
                <input type="time" class="form-control" id="tijdstip" required>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-2" for="locatie">Locatie:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="locatie" placeholder="Vul locatie in" required>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-2" for="Aantal trainingen">Aantal trainingen:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="aantalTrainingen" placeholder="Vul aantal trainingen in"
                    required>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-sm-2" for="team">Team:</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="team" placeholder="Vul het team in" required>
            </div>
        </div>
        <div class="row">
            <div type="divContainer" id="showData"></div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button type="button" class="btn btn-primary" onclick="aanmaakTraining()">Maak training aan</button>
                <button type="button" class="btn btn-primary" onclick="verwijsPagina('index.html')">Annuleer</button>
            </div>
        </div>
    </form>


</body>

</html>